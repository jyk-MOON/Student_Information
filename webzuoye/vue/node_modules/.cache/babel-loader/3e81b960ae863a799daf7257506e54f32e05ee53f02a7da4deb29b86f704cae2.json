{"ast":null,"code":"export default {\n  name: \"StudentBorrowQuery\",\n  data() {\n    return {\n      // 搜索相关\n      searchInput: '',\n      searchType: 'studentId',\n      // 当前学生信息\n      currentStudent: {},\n      // 历史借阅记录\n      historyBorrowList: [],\n      loadingHistory: false,\n      historyPageNum: 1,\n      historyPageSize: 10,\n      historyTotal: 0,\n      // 学生列表对话框\n      studentListVisible: false,\n      studentListSearch: '',\n      studentList: []\n    };\n  },\n  computed: {\n    // 过滤后的学生列表\n    filteredStudentList() {\n      if (!this.studentListSearch) return this.studentList;\n      const search = this.studentListSearch.toLowerCase();\n      return this.studentList.filter(student => student.studentId && student.studentId.toLowerCase().includes(search) || student.name && student.name.toLowerCase().includes(search) || student.phone && student.phone.includes(search));\n    }\n  },\n  methods: {\n    // 搜索学生\n    handleSearch() {\n      if (!this.searchInput.trim()) {\n        this.$message.warning('请输入搜索内容');\n        return;\n      }\n      console.log('搜索学生，类型:', this.searchType, '关键词:', this.searchInput);\n\n      // 构建查询参数\n      const params = {\n        pageNum: 1,\n        pageSize: 10\n      };\n\n      // 根据搜索类型设置参数\n      if (this.searchType === 'studentId') {\n        params.studentId = this.searchInput;\n      } else if (this.searchType === 'name') {\n        params.name = this.searchInput;\n      }\n      this.$request.get('/user/selectPage', {\n        params: params\n      }).then(res => {\n        console.log('学生搜索响应:', res);\n        if (res.code === '200' && res.data?.list?.length > 0) {\n          // 如果有多个结果，显示选择对话框\n          if (res.data.list.length > 1) {\n            this.studentList = res.data.list;\n            this.studentListVisible = true;\n          } else {\n            // 只有一个结果，直接选择\n            this.selectStudent(res.data.list[0]);\n          }\n        } else {\n          this.$message.warning('未找到匹配的学生');\n        }\n      }).catch(err => {\n        console.error('搜索学生出错:', err);\n        this.$message.error('搜索失败，请检查网络连接');\n      });\n    },\n    // 切换搜索类型\n    handleSearchTypeChange() {\n      this.searchInput = '';\n      this.$message.info(`已切换为按${this.searchType === 'studentId' ? '学号' : '姓名'}搜索`);\n    },\n    // 显示学生列表\n    showStudentList() {\n      // 加载所有学生\n      this.$request.get('/user/selectPage', {\n        params: {\n          pageNum: 1,\n          pageSize: 100\n        }\n      }).then(res => {\n        if (res.code === '200' && res.data?.list) {\n          this.studentList = res.data.list;\n          this.studentListVisible = true;\n        } else {\n          this.$message.warning('获取学生列表失败');\n        }\n      });\n    },\n    // 重置搜索\n    resetSearch() {\n      this.searchInput = '';\n      this.currentStudent = {};\n      this.historyBorrowList = [];\n      this.historyTotal = 0;\n    },\n    // 选择学生\n    selectStudent(student) {\n      console.log('选择学生:', student);\n      this.currentStudent = student;\n      this.studentListVisible = false;\n\n      // 加载该学生的借阅数据\n      this.loadHistoryBorrows();\n    },\n    // 加载历史借阅记录\n    loadHistoryBorrows() {\n      if (!this.currentStudent.id) {\n        this.$message.warning('请先选择学生');\n        return;\n      }\n      this.loadingHistory = true;\n      console.log('加载学生借阅记录，学生ID:', this.currentStudent.id);\n\n      // 调用分页查询接口\n      this.$request.get('/book/borrow/selectPage', {\n        params: {\n          pageNum: this.historyPageNum,\n          pageSize: this.historyPageSize,\n          userId: this.currentStudent.id\n        }\n      }).then(res => {\n        this.loadingHistory = false;\n        console.log('借阅记录响应:', res);\n        if (res.code === '200') {\n          this.historyBorrowList = res.data?.list || [];\n          this.historyTotal = res.data?.total || 0;\n\n          // 为每条记录添加加载状态\n          this.historyBorrowList.forEach(record => {\n            record.returnLoading = false;\n          });\n        } else {\n          this.$message.error(res.msg || '获取借阅记录失败');\n        }\n      }).catch(err => {\n        this.loadingHistory = false;\n        console.error('获取借阅记录出错:', err);\n        this.$message.error('获取借阅记录失败');\n      });\n    },\n    // 学生列表行点击\n    handleStudentSelect(row) {\n      this.selectStudent(row);\n    },\n    // 历史记录分页切换\n    handleHistoryPageChange(pageNum) {\n      this.historyPageNum = pageNum;\n      this.loadHistoryBorrows();\n    },\n    // 历史记录每页条数切换\n    handleHistorySizeChange(pageSize) {\n      this.historyPageSize = pageSize;\n      this.historyPageNum = 1;\n      this.loadHistoryBorrows();\n    },\n    // 归还图书\n    async handleReturn(record) {\n      console.log('归还图书，记录:', record);\n      try {\n        // 设置加载状态\n        record.returnLoading = true;\n        await this.$confirm(`确认归还图书《${record.bookName}》吗？`, '办理归还', {\n          confirmButtonText: '确认归还',\n          cancelButtonText: '取消',\n          type: 'warning'\n        });\n\n        // 获取当前管理员ID（从登录信息获取）\n        const user = JSON.parse(localStorage.getItem(\"xm-user\") || '{}');\n        const adminId = user.id;\n        if (!adminId) {\n          this.$message.error('无法获取管理员信息，请重新登录');\n          record.returnLoading = false;\n          return;\n        }\n        console.log('归还参数:', {\n          borrowId: record.id,\n          adminId: adminId\n        });\n\n        // 调用归还接口\n        const res = await this.$request.post(`/book/return/${record.id}`, null, {\n          params: {\n            adminId\n          }\n        });\n        console.log('归还响应:', res);\n        if (res.code === '200') {\n          this.$message.success('归还成功');\n          // 重新加载借阅记录\n          this.loadHistoryBorrows();\n        } else {\n          this.$message.error(res.msg || '归还失败');\n          record.returnLoading = false;\n        }\n      } catch (error) {\n        console.log('取消操作或操作失败:', error);\n        record.returnLoading = false;\n\n        // 如果是用户取消操作，不做处理\n        if (error !== 'cancel' && error.message !== 'cancel') {\n          this.$message.error('操作失败: ' + (error.message || '未知错误'));\n        }\n      }\n    },\n    // 导出历史记录\n    exportHistory() {\n      this.$message.info('导出功能开发中...');\n      // 实际开发中可以调用导出接口\n    },\n\n    // 工具方法：格式化日期\n    formatDate(dateStr) {\n      if (!dateStr) return '--';\n      try {\n        const date = new Date(dateStr);\n        return date.toLocaleDateString('zh-CN', {\n          year: 'numeric',\n          month: '2-digit',\n          day: '2-digit'\n        }).replace(/\\//g, '-');\n      } catch (e) {\n        return dateStr;\n      }\n    },\n    // 判断是否超期\n    isOverdue(record) {\n      if (!record.dueTime || record.returnTime) return false;\n      const dueDate = new Date(record.dueTime);\n      const now = new Date();\n      return now > dueDate;\n    }\n  }\n};","map":{"version":3,"names":["name","data","searchInput","searchType","currentStudent","historyBorrowList","loadingHistory","historyPageNum","historyPageSize","historyTotal","studentListVisible","studentListSearch","studentList","computed","filteredStudentList","search","toLowerCase","filter","student","studentId","includes","phone","methods","handleSearch","trim","$message","warning","console","log","params","pageNum","pageSize","$request","get","then","res","code","list","length","selectStudent","catch","err","error","handleSearchTypeChange","info","showStudentList","resetSearch","loadHistoryBorrows","id","userId","total","forEach","record","returnLoading","msg","handleStudentSelect","row","handleHistoryPageChange","handleHistorySizeChange","handleReturn","$confirm","bookName","confirmButtonText","cancelButtonText","type","user","JSON","parse","localStorage","getItem","adminId","borrowId","post","success","message","exportHistory","formatDate","dateStr","date","Date","toLocaleDateString","year","month","day","replace","e","isOverdue","dueTime","returnTime","dueDate","now"],"sources":["src/views/manager/StudentBorrowQuery.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <!-- 1. 学生搜索区 -->\r\n    <el-card shadow=\"hover\" style=\"margin-bottom: 20px;\">\r\n      <div slot=\"header\" class=\"clearfix\">\r\n        <span style=\"font-weight: bold; color: #409EFF;\">\r\n          <i class=\"el-icon-search\"></i> 学生查询\r\n        </span>\r\n      </div>\r\n\r\n      <div class=\"search-container\">\r\n        <div style=\"display: flex; align-items: center; gap: 15px;\">\r\n          <div style=\"flex: 1;\">\r\n            <el-input\r\n                v-model=\"searchInput\"\r\n                placeholder=\"请输入学生学号、姓名进行查询\"\r\n                style=\"width: 100%\"\r\n                @keyup.enter.native=\"handleSearch\"\r\n                clearable>\r\n              <el-select\r\n                  v-model=\"searchType\"\r\n                  slot=\"prepend\"\r\n                  style=\"width: 100px\"\r\n                  @change=\"handleSearchTypeChange\">\r\n                <el-option label=\"学号\" value=\"studentId\"></el-option>\r\n                <el-option label=\"姓名\" value=\"name\"></el-option>\r\n              </el-select>\r\n              <el-button\r\n                  slot=\"append\"\r\n                  icon=\"el-icon-search\"\r\n                  type=\"primary\"\r\n                  @click=\"handleSearch\">\r\n              </el-button>\r\n            </el-input>\r\n          </div>\r\n\r\n          <div>\r\n            <el-button type=\"info\" plain @click=\"showStudentList\">\r\n              <i class=\"el-icon-user\"></i> 学生列表\r\n            </el-button>\r\n            <el-button type=\"warning\" plain @click=\"resetSearch\">\r\n              <i class=\"el-icon-refresh\"></i> 重置\r\n            </el-button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </el-card>\r\n\r\n    <!-- 2. 学生信息展示区（简化版） -->\r\n    <el-card v-if=\"currentStudent.id\" shadow=\"hover\" style=\"margin-bottom: 20px;\">\r\n      <div slot=\"header\" class=\"clearfix\">\r\n        <span style=\"font-weight: bold; color: #67C23A;\">\r\n          <i class=\"el-icon-user-solid\"></i> 学生信息\r\n        </span>\r\n      </div>\r\n\r\n      <div class=\"student-info\">\r\n        <div style=\"display: flex; align-items: center; margin-bottom: 15px;\">\r\n          <div style=\"width: 80px; height: 80px; background-color: #f0f9ff; border-radius: 50%;\r\n                     display: flex; align-items: center; justify-content: center; margin-right: 20px;\">\r\n            <i class=\"el-icon-user\" style=\"font-size: 40px; color: #409EFF;\"></i>\r\n          </div>\r\n\r\n          <div style=\"flex: 1;\">\r\n            <div style=\"display: flex; flex-wrap: wrap; gap: 30px;\">\r\n              <div class=\"info-item\">\r\n                <div class=\"info-label\">学号</div>\r\n                <div class=\"info-value\">{{ currentStudent.studentId || currentStudent.id }}</div>\r\n              </div>\r\n              <div class=\"info-item\">\r\n                <div class=\"info-label\">姓名</div>\r\n                <div class=\"info-value\">{{ currentStudent.name }}</div>\r\n              </div>\r\n              <div class=\"info-item\">\r\n                <div class=\"info-label\">联系方式</div>\r\n                <div class=\"info-value\">{{ currentStudent.phone || '未填写' }}</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </el-card>\r\n\r\n    <!-- 3. 历史借阅记录 -->\r\n    <el-card v-if=\"currentStudent.id\" shadow=\"hover\">\r\n      <div slot=\"header\" class=\"clearfix\">\r\n        <span style=\"font-weight: bold; color: #909399;\">\r\n          <i class=\"el-icon-timer\"></i> 借阅记录\r\n        </span>\r\n        <div style=\"float: right;\">\r\n          <el-button\r\n              type=\"info\"\r\n              size=\"mini\"\r\n              plain\r\n              @click=\"exportHistory\">\r\n            <i class=\"el-icon-download\"></i> 导出记录\r\n          </el-button>\r\n          <el-button\r\n              type=\"primary\"\r\n              size=\"mini\"\r\n              plain\r\n              @click=\"loadHistoryBorrows\">\r\n            <i class=\"el-icon-refresh\"></i> 刷新\r\n          </el-button>\r\n        </div>\r\n      </div>\r\n\r\n      <div v-if=\"historyBorrowList.length > 0\">\r\n        <el-table\r\n            :data=\"historyBorrowList\"\r\n            stripe\r\n            v-loading=\"loadingHistory\">\r\n\r\n          <el-table-column label=\"图书信息\" min-width=\"200\">\r\n            <template v-slot=\"scope\">\r\n              <div>\r\n                <div style=\"font-weight: 500;\">{{ scope.row.bookName }}</div>\r\n                <div style=\"font-size: 12px; color: #909399; margin-top: 2px;\">\r\n                  {{ scope.row.bookAuthor }} | ISBN: {{ scope.row.bookIsbn }}\r\n                </div>\r\n              </div>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"借阅时间\" width=\"150\" align=\"center\">\r\n            <template v-slot=\"scope\">\r\n              {{ formatDate(scope.row.borrowTime) }}\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"应还时间\" width=\"150\" align=\"center\">\r\n            <template v-slot=\"scope\">\r\n              <div :style=\"{color: isOverdue(scope.row) ? '#F56C6C' : '#67C23A'}\">\r\n                {{ formatDate(scope.row.dueTime) }}\r\n              </div>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"归还时间\" width=\"150\" align=\"center\">\r\n            <template v-slot=\"scope\">\r\n              {{ formatDate(scope.row.returnTime) || '--' }}\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"状态\" width=\"100\" align=\"center\">\r\n            <template v-slot=\"scope\">\r\n              <el-tag\r\n                  :type=\"scope.row.returnTime ? 'success' : 'warning'\"\r\n                  size=\"small\">\r\n                {{ scope.row.returnTime ? '已归还' : '借阅中' }}\r\n              </el-tag>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"超期状态\" width=\"100\" align=\"center\">\r\n            <template v-slot=\"scope\">\r\n              <el-tag\r\n                  v-if=\"!scope.row.returnTime && isOverdue(scope.row)\"\r\n                  type=\"danger\"\r\n                  size=\"small\"\r\n                  effect=\"dark\">\r\n                已超期\r\n              </el-tag>\r\n              <span v-else-if=\"scope.row.returnTime\">--</span>\r\n              <span v-else style=\"color: #67C23A;\">正常</span>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"操作\" width=\"120\" align=\"center\">\r\n            <template v-slot=\"scope\">\r\n              <el-button\r\n                  v-if=\"!scope.row.returnTime\"\r\n                  type=\"success\"\r\n                  size=\"mini\"\r\n                  @click=\"handleReturn(scope.row)\"\r\n                  :loading=\"scope.row.returnLoading\">\r\n                归还\r\n              </el-button>\r\n              <span v-else style=\"color: #909399;\">已归还</span>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n\r\n        <!-- 分页 -->\r\n        <div style=\"margin-top: 15px; text-align: center;\">\r\n          <el-pagination\r\n              background\r\n              @current-change=\"handleHistoryPageChange\"\r\n              @size-change=\"handleHistorySizeChange\"\r\n              :current-page=\"historyPageNum\"\r\n              :page-sizes=\"[10, 20, 50]\"\r\n              :page-size=\"historyPageSize\"\r\n              layout=\"total, sizes, prev, pager, next\"\r\n              :total=\"historyTotal\">\r\n          </el-pagination>\r\n        </div>\r\n      </div>\r\n\r\n      <div v-else style=\"text-align: center; padding: 40px; color: #909399;\">\r\n        <i class=\"el-icon-document\" style=\"font-size: 60px; margin-bottom: 15px;\"></i>\r\n        <div style=\"font-size: 16px;\">该学生暂无借阅记录</div>\r\n      </div>\r\n    </el-card>\r\n\r\n    <!-- 4. 学生选择对话框 -->\r\n    <el-dialog\r\n        title=\"选择学生\"\r\n        :visible.sync=\"studentListVisible\"\r\n        width=\"70%\"\r\n        :close-on-click-modal=\"false\">\r\n\r\n      <div style=\"margin-bottom: 15px;\">\r\n        <el-input\r\n            v-model=\"studentListSearch\"\r\n            placeholder=\"搜索学生\"\r\n            style=\"width: 300px\"\r\n            clearable>\r\n          <el-button slot=\"append\" icon=\"el-icon-search\"></el-button>\r\n        </el-input>\r\n      </div>\r\n\r\n      <el-table\r\n          :data=\"filteredStudentList\"\r\n          stripe\r\n          @row-click=\"handleStudentSelect\"\r\n          height=\"400\">\r\n\r\n        <el-table-column prop=\"studentId\" label=\"学号\" width=\"120\" align=\"center\"></el-table-column>\r\n        <el-table-column prop=\"name\" label=\"姓名\" width=\"100\" align=\"center\"></el-table-column>\r\n        <el-table-column prop=\"phone\" label=\"联系方式\" width=\"120\"></el-table-column>\r\n        <el-table-column label=\"操作\" width=\"80\" align=\"center\">\r\n          <template v-slot=\"scope\">\r\n            <el-button type=\"text\" size=\"mini\" @click.stop=\"selectStudent(scope.row)\">选择</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"studentListVisible = false\">取消</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"StudentBorrowQuery\",\r\n  data() {\r\n    return {\r\n      // 搜索相关\r\n      searchInput: '',\r\n      searchType: 'studentId',\r\n\r\n      // 当前学生信息\r\n      currentStudent: {},\r\n\r\n      // 历史借阅记录\r\n      historyBorrowList: [],\r\n      loadingHistory: false,\r\n      historyPageNum: 1,\r\n      historyPageSize: 10,\r\n      historyTotal: 0,\r\n\r\n      // 学生列表对话框\r\n      studentListVisible: false,\r\n      studentListSearch: '',\r\n      studentList: []\r\n    }\r\n  },\r\n  computed: {\r\n    // 过滤后的学生列表\r\n    filteredStudentList() {\r\n      if (!this.studentListSearch) return this.studentList\r\n\r\n      const search = this.studentListSearch.toLowerCase()\r\n      return this.studentList.filter(student =>\r\n          (student.studentId && student.studentId.toLowerCase().includes(search)) ||\r\n          (student.name && student.name.toLowerCase().includes(search)) ||\r\n          (student.phone && student.phone.includes(search))\r\n      )\r\n    }\r\n  },\r\n  methods: {\r\n    // 搜索学生\r\n    handleSearch() {\r\n      if (!this.searchInput.trim()) {\r\n        this.$message.warning('请输入搜索内容')\r\n        return\r\n      }\r\n\r\n      console.log('搜索学生，类型:', this.searchType, '关键词:', this.searchInput)\r\n\r\n      // 构建查询参数\r\n      const params = {\r\n        pageNum: 1,\r\n        pageSize: 10\r\n      }\r\n\r\n      // 根据搜索类型设置参数\r\n      if (this.searchType === 'studentId') {\r\n        params.studentId = this.searchInput\r\n      } else if (this.searchType === 'name') {\r\n        params.name = this.searchInput\r\n      }\r\n\r\n      this.$request.get('/user/selectPage', {\r\n        params: params\r\n      }).then(res => {\r\n        console.log('学生搜索响应:', res)\r\n        if (res.code === '200' && res.data?.list?.length > 0) {\r\n          // 如果有多个结果，显示选择对话框\r\n          if (res.data.list.length > 1) {\r\n            this.studentList = res.data.list\r\n            this.studentListVisible = true\r\n          } else {\r\n            // 只有一个结果，直接选择\r\n            this.selectStudent(res.data.list[0])\r\n          }\r\n        } else {\r\n          this.$message.warning('未找到匹配的学生')\r\n        }\r\n      }).catch(err => {\r\n        console.error('搜索学生出错:', err)\r\n        this.$message.error('搜索失败，请检查网络连接')\r\n      })\r\n    },\r\n\r\n    // 切换搜索类型\r\n    handleSearchTypeChange() {\r\n      this.searchInput = ''\r\n      this.$message.info(`已切换为按${this.searchType === 'studentId' ? '学号' : '姓名'}搜索`)\r\n    },\r\n\r\n    // 显示学生列表\r\n    showStudentList() {\r\n      // 加载所有学生\r\n      this.$request.get('/user/selectPage', {\r\n        params: {\r\n          pageNum: 1,\r\n          pageSize: 100\r\n        }\r\n      }).then(res => {\r\n        if (res.code === '200' && res.data?.list) {\r\n          this.studentList = res.data.list\r\n          this.studentListVisible = true\r\n        } else {\r\n          this.$message.warning('获取学生列表失败')\r\n        }\r\n      })\r\n    },\r\n\r\n    // 重置搜索\r\n    resetSearch() {\r\n      this.searchInput = ''\r\n      this.currentStudent = {}\r\n      this.historyBorrowList = []\r\n      this.historyTotal = 0\r\n    },\r\n\r\n    // 选择学生\r\n    selectStudent(student) {\r\n      console.log('选择学生:', student)\r\n      this.currentStudent = student\r\n      this.studentListVisible = false\r\n\r\n      // 加载该学生的借阅数据\r\n      this.loadHistoryBorrows()\r\n    },\r\n\r\n    // 加载历史借阅记录\r\n    loadHistoryBorrows() {\r\n      if (!this.currentStudent.id) {\r\n        this.$message.warning('请先选择学生')\r\n        return\r\n      }\r\n\r\n      this.loadingHistory = true\r\n      console.log('加载学生借阅记录，学生ID:', this.currentStudent.id)\r\n\r\n      // 调用分页查询接口\r\n      this.$request.get('/book/borrow/selectPage', {\r\n        params: {\r\n          pageNum: this.historyPageNum,\r\n          pageSize: this.historyPageSize,\r\n          userId: this.currentStudent.id\r\n        }\r\n      }).then(res => {\r\n        this.loadingHistory = false\r\n        console.log('借阅记录响应:', res)\r\n\r\n        if (res.code === '200') {\r\n          this.historyBorrowList = res.data?.list || []\r\n          this.historyTotal = res.data?.total || 0\r\n\r\n          // 为每条记录添加加载状态\r\n          this.historyBorrowList.forEach(record => {\r\n            record.returnLoading = false\r\n          })\r\n        } else {\r\n          this.$message.error(res.msg || '获取借阅记录失败')\r\n        }\r\n      }).catch(err => {\r\n        this.loadingHistory = false\r\n        console.error('获取借阅记录出错:', err)\r\n        this.$message.error('获取借阅记录失败')\r\n      })\r\n    },\r\n\r\n    // 学生列表行点击\r\n    handleStudentSelect(row) {\r\n      this.selectStudent(row)\r\n    },\r\n\r\n    // 历史记录分页切换\r\n    handleHistoryPageChange(pageNum) {\r\n      this.historyPageNum = pageNum\r\n      this.loadHistoryBorrows()\r\n    },\r\n\r\n    // 历史记录每页条数切换\r\n    handleHistorySizeChange(pageSize) {\r\n      this.historyPageSize = pageSize\r\n      this.historyPageNum = 1\r\n      this.loadHistoryBorrows()\r\n    },\r\n\r\n    // 归还图书\r\n    async handleReturn(record) {\r\n      console.log('归还图书，记录:', record)\r\n\r\n      try {\r\n        // 设置加载状态\r\n        record.returnLoading = true\r\n\r\n        await this.$confirm(`确认归还图书《${record.bookName}》吗？`, '办理归还', {\r\n          confirmButtonText: '确认归还',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        })\r\n\r\n        // 获取当前管理员ID（从登录信息获取）\r\n        const user = JSON.parse(localStorage.getItem(\"xm-user\") || '{}')\r\n        const adminId = user.id\r\n\r\n        if (!adminId) {\r\n          this.$message.error('无法获取管理员信息，请重新登录')\r\n          record.returnLoading = false\r\n          return\r\n        }\r\n\r\n        console.log('归还参数:', {\r\n          borrowId: record.id,\r\n          adminId: adminId\r\n        })\r\n\r\n        // 调用归还接口\r\n        const res = await this.$request.post(`/book/return/${record.id}`, null, {\r\n          params: { adminId }\r\n        })\r\n\r\n        console.log('归还响应:', res)\r\n\r\n        if (res.code === '200') {\r\n          this.$message.success('归还成功')\r\n          // 重新加载借阅记录\r\n          this.loadHistoryBorrows()\r\n        } else {\r\n          this.$message.error(res.msg || '归还失败')\r\n          record.returnLoading = false\r\n        }\r\n      } catch (error) {\r\n        console.log('取消操作或操作失败:', error)\r\n        record.returnLoading = false\r\n\r\n        // 如果是用户取消操作，不做处理\r\n        if (error !== 'cancel' && error.message !== 'cancel') {\r\n          this.$message.error('操作失败: ' + (error.message || '未知错误'))\r\n        }\r\n      }\r\n    },\r\n\r\n    // 导出历史记录\r\n    exportHistory() {\r\n      this.$message.info('导出功能开发中...')\r\n      // 实际开发中可以调用导出接口\r\n    },\r\n\r\n    // 工具方法：格式化日期\r\n    formatDate(dateStr) {\r\n      if (!dateStr) return '--'\r\n      try {\r\n        const date = new Date(dateStr)\r\n        return date.toLocaleDateString('zh-CN', {\r\n          year: 'numeric',\r\n          month: '2-digit',\r\n          day: '2-digit'\r\n        }).replace(/\\//g, '-')\r\n      } catch (e) {\r\n        return dateStr\r\n      }\r\n    },\r\n\r\n    // 判断是否超期\r\n    isOverdue(record) {\r\n      if (!record.dueTime || record.returnTime) return false\r\n\r\n      const dueDate = new Date(record.dueTime)\r\n      const now = new Date()\r\n      return now > dueDate\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.search-container {\r\n  padding: 10px;\r\n}\r\n\r\n.student-info {\r\n  padding: 10px;\r\n}\r\n\r\n.info-item {\r\n  margin-bottom: 10px;\r\n  min-width: 150px;\r\n}\r\n\r\n.info-label {\r\n  font-size: 12px;\r\n  color: #909399;\r\n  margin-bottom: 4px;\r\n}\r\n\r\n.info-value {\r\n  font-size: 16px;\r\n  font-weight: 500;\r\n  color: #303133;\r\n}\r\n\r\n/* 表格行悬停效果 */\r\n.el-table >>> tbody tr:hover {\r\n  cursor: pointer;\r\n}\r\n\r\n/* 卡片标题样式 */\r\n.el-card__header {\r\n  background-color: #fafafa;\r\n  border-bottom: 1px solid #ebeef5;\r\n}\r\n\r\n/* 响应式调整 */\r\n@media (max-width: 768px) {\r\n  .search-container > div {\r\n    flex-direction: column;\r\n  }\r\n\r\n  .info-item {\r\n    min-width: 100%;\r\n  }\r\n}\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}