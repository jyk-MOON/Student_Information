{"ast":null,"code":"export default {\n  name: \"StudentBorrowQuery\",\n  data() {\n    return {\n      // 搜索相关\n      searchInput: '',\n      searchType: 'studentId',\n      // 当前学生信息\n      currentStudent: {},\n      // 借阅统计\n      borrowStats: {\n        totalBorrowed: 0,\n        currentBorrowing: 0,\n        overdue: 0\n      },\n      // 当前借阅列表\n      currentBorrowList: [],\n      loadingCurrent: false,\n      selectedCurrentBorrows: [],\n      // 历史借阅记录\n      historyBorrowList: [],\n      loadingHistory: false,\n      historyPageNum: 1,\n      historyPageSize: 10,\n      historyTotal: 0,\n      // 学生列表对话框\n      studentListVisible: false,\n      studentListSearch: '',\n      studentList: []\n    };\n  },\n  computed: {\n    // 过滤后的学生列表\n    filteredStudentList() {\n      if (!this.studentListSearch) return this.studentList;\n      const search = this.studentListSearch.toLowerCase();\n      return this.studentList.filter(student => student.studentId && student.studentId.toLowerCase().includes(search) || student.name && student.name.toLowerCase().includes(search) || student.phone && student.phone.includes(search));\n    }\n  },\n  methods: {\n    // 搜索学生\n    handleSearch() {\n      if (!this.searchInput.trim()) {\n        this.$message.warning('请输入搜索内容');\n        return;\n      }\n      console.log('搜索学生，类型:', this.searchType, '关键词:', this.searchInput);\n\n      // 构建查询参数\n      const params = {\n        pageNum: 1,\n        pageSize: 10\n      };\n\n      // 根据搜索类型设置参数\n      if (this.searchType === 'studentId') {\n        params.studentId = this.searchInput;\n      } else if (this.searchType === 'name') {\n        params.name = this.searchInput;\n      }\n      this.$request.get('/user/selectPage', {\n        params: params\n      }).then(res => {\n        console.log('学生搜索响应:', res);\n        if (res.code === '200' && res.data?.list?.length > 0) {\n          // 如果有多个结果，显示选择对话框\n          if (res.data.list.length > 1) {\n            this.studentList = res.data.list;\n            this.studentListVisible = true;\n          } else {\n            // 只有一个结果，直接选择\n            this.selectStudent(res.data.list[0]);\n          }\n        } else {\n          this.$message.warning('未找到匹配的学生');\n        }\n      }).catch(err => {\n        console.error('搜索学生出错:', err);\n        this.$message.error('搜索失败，请检查网络连接');\n      });\n    },\n    // 切换搜索类型\n    handleSearchTypeChange() {\n      this.searchInput = '';\n      this.$message.info(`已切换为按${this.searchType === 'studentId' ? '学号' : '姓名'}搜索`);\n    },\n    // 显示学生列表\n    showStudentList() {\n      // 加载所有学生\n      this.$request.get('/user/selectPage', {\n        params: {\n          pageNum: 1,\n          pageSize: 100\n        }\n      }).then(res => {\n        if (res.code === '200' && res.data?.list) {\n          this.studentList = res.data.list;\n          this.studentListVisible = true;\n        } else {\n          this.$message.warning('获取学生列表失败');\n        }\n      });\n    },\n    // 重置搜索\n    resetSearch() {\n      this.searchInput = '';\n      this.currentStudent = {};\n      this.currentBorrowList = [];\n      this.historyBorrowList = [];\n      this.borrowStats = {\n        totalBorrowed: 0,\n        currentBorrowing: 0,\n        overdue: 0\n      };\n    },\n    // 选择学生\n    selectStudent(student) {\n      console.log('选择学生:', student);\n      this.currentStudent = student;\n      this.studentListVisible = false;\n\n      // 加载该学生的借阅数据\n      this.loadBorrowData();\n    },\n    // 加载借阅数据\n    loadBorrowData() {\n      if (!this.currentStudent.id) {\n        this.$message.warning('请先选择学生');\n        return;\n      }\n      console.log('加载学生借阅数据，学生ID:', this.currentStudent.id);\n      this.loadCurrentBorrows();\n      this.loadHistoryBorrows();\n      this.calculateBorrowStats();\n    },\n    // 加载当前借阅\n    async loadCurrentBorrows() {\n      this.loadingCurrent = true;\n      console.log('开始加载当前借阅，学生ID:', this.currentStudent.id);\n      try {\n        // 方案1：调用专用接口获取该学生的借阅记录\n        const res = await this.$request.get(`/book/borrow/user/${this.currentStudent.id}`);\n        console.log('当前借阅接口响应:', res);\n        if (res.code === '200') {\n          const allBorrows = res.data || [];\n          console.log('所有借阅记录:', allBorrows);\n\n          // 重要：打印每条记录的状态信息，用于调试\n          allBorrows.forEach((record, index) => {\n            console.log(`记录${index}:`, {\n              id: record.id,\n              图书: record.bookName,\n              借阅时间: record.borrowTime,\n              归还时间: record.returnTime,\n              应还时间: record.dueTime,\n              是否有returnTime: !!record.returnTime,\n              returnTime值: record.returnTime\n            });\n          });\n\n          // 过滤出未归还的记录\n          // 关键：正确的过滤逻辑应该是 returnTime 为空、null 或 undefined\n          const currentBorrows = allBorrows.filter(record => {\n            // 多个条件判断，确保不会误判\n            const hasReturnTime = record.returnTime !== null && record.returnTime !== undefined && record.returnTime !== '';\n            console.log(`记录 ${record.id} 的 returnTime: \"${record.returnTime}\"`, `是否视为已归还: ${hasReturnTime}`);\n            return !hasReturnTime;\n          });\n          console.log('筛选后的当前借阅记录:', currentBorrows);\n          console.log('筛选前总数:', allBorrows.length, '筛选后:', currentBorrows.length);\n          this.currentBorrowList = currentBorrows;\n          this.selectedCurrentBorrows = [];\n\n          // 为每条记录添加加载状态\n          this.currentBorrowList.forEach(record => {\n            record.returnLoading = false;\n          });\n\n          // 如果没有找到当前借阅，显示提示信息\n          if (currentBorrows.length === 0 && allBorrows.length > 0) {\n            console.warn('警告：有历史借阅记录，但没有当前借阅记录');\n            console.warn('可能原因：所有记录的returnTime都有值');\n          }\n        } else {\n          console.error('获取当前借阅失败:', res.msg);\n          this.$message.error(res.msg || '获取当前借阅失败');\n          this.currentBorrowList = [];\n        }\n      } catch (error) {\n        console.error('获取当前借阅出错:', error);\n        this.$message.error('获取当前借阅失败，请检查网络连接');\n        this.currentBorrowList = [];\n      } finally {\n        this.loadingCurrent = false;\n      }\n    },\n    // 加载历史借阅记录\n    loadHistoryBorrows() {\n      this.loadingHistory = true;\n\n      // 调用分页查询接口\n      this.$request.get('/book/borrow/selectPage', {\n        params: {\n          pageNum: this.historyPageNum,\n          pageSize: this.historyPageSize,\n          userId: this.currentStudent.id\n        }\n      }).then(res => {\n        this.loadingHistory = false;\n        if (res.code === '200') {\n          this.historyBorrowList = res.data?.list || [];\n          this.historyTotal = res.data?.total || 0;\n        } else {\n          this.$message.error(res.msg || '获取历史记录失败');\n        }\n      }).catch(err => {\n        this.loadingHistory = false;\n        console.error('获取历史记录出错:', err);\n      });\n    },\n    // 计算借阅统计\n    calculateBorrowStats() {\n      this.borrowStats = {\n        totalBorrowed: this.historyTotal,\n        currentBorrowing: this.currentBorrowList.length,\n        overdue: this.currentBorrowList.filter(record => this.isOverdue(record)).length\n      };\n    },\n    // 当前借阅多选\n    handleCurrentBorrowSelection(selection) {\n      this.selectedCurrentBorrows = selection;\n    },\n    // 单本归还\n    async handleSingleReturn(record) {\n      console.log('单本归还，记录:', record);\n      try {\n        // 设置加载状态\n        record.returnLoading = true;\n        await this.$confirm(`确认归还图书《${record.bookName}》吗？`, '办理归还', {\n          confirmButtonText: '确认归还',\n          cancelButtonText: '取消',\n          type: 'warning'\n        });\n\n        // 获取当前管理员ID（从登录信息获取）\n        const user = JSON.parse(localStorage.getItem(\"xm-user\") || '{}');\n        const adminId = user.id;\n        if (!adminId) {\n          this.$message.error('无法获取管理员信息，请重新登录');\n          record.returnLoading = false;\n          return;\n        }\n        console.log('归还参数:', {\n          borrowId: record.id,\n          adminId: adminId\n        });\n\n        // 调用归还接口\n        const res = await this.$request.post(`/book/return/${record.id}`, null, {\n          params: {\n            adminId\n          }\n        });\n        console.log('归还响应:', res);\n        if (res.code === '200') {\n          this.$message.success('归还成功');\n          // 重新加载所有数据\n          this.loadBorrowData();\n        } else {\n          this.$message.error(res.msg || '归还失败');\n          record.returnLoading = false;\n        }\n      } catch (error) {\n        console.log('取消操作或操作失败:', error);\n        record.returnLoading = false;\n\n        // 如果是用户取消操作，不做处理\n        if (error !== 'cancel' && error.message !== 'cancel') {\n          this.$message.error('操作失败: ' + (error.message || '未知错误'));\n        }\n      }\n    },\n    // 批量归还\n    async handleBatchReturn() {\n      if (this.selectedCurrentBorrows.length === 0) {\n        this.$message.warning('请选择要归还的图书');\n        return;\n      }\n      const bookNames = this.selectedCurrentBorrows.map(item => item.bookName).join('、');\n      try {\n        await this.$confirm(`确认批量归还 ${this.selectedCurrentBorrows.length} 本图书吗？\\n\\n${bookNames}`, '批量归还', {\n          confirmButtonText: '确认归还',\n          cancelButtonText: '取消',\n          type: 'warning'\n        });\n\n        // 获取当前管理员ID\n        const user = JSON.parse(localStorage.getItem(\"xm-user\") || '{}');\n        const adminId = user.id;\n        if (!adminId) {\n          this.$message.error('无法获取管理员信息');\n          return;\n        }\n        let successCount = 0;\n        let failCount = 0;\n\n        // 为选中的记录添加加载状态\n        this.selectedCurrentBorrows.forEach(record => {\n          record.returnLoading = true;\n        });\n\n        // 逐个处理归还\n        for (const record of this.selectedCurrentBorrows) {\n          try {\n            const res = await this.$request.post(`/book/return/${record.id}`, null, {\n              params: {\n                adminId\n              }\n            });\n            if (res.code === '200') {\n              successCount++;\n            } else {\n              failCount++;\n              console.error(`归还 ${record.bookName} 失败:`, res.msg);\n            }\n          } catch (error) {\n            failCount++;\n            console.error(`归还 ${record.bookName} 异常:`, error);\n          }\n        }\n\n        // 清除加载状态\n        this.selectedCurrentBorrows.forEach(record => {\n          record.returnLoading = false;\n        });\n\n        // 显示结果\n        let message = '';\n        if (successCount > 0) {\n          message += `成功归还 ${successCount} 本图书`;\n        }\n        if (failCount > 0) {\n          message += `，失败 ${failCount} 本`;\n        }\n        if (message) {\n          this.$message.success(message);\n        }\n\n        // 刷新数据\n        this.loadBorrowData();\n        this.selectedCurrentBorrows = [];\n      } catch (error) {\n        console.log('取消批量归还操作');\n\n        // 清除加载状态\n        this.selectedCurrentBorrows.forEach(record => {\n          record.returnLoading = false;\n        });\n      }\n    },\n    // 学生列表行点击\n    handleStudentSelect(row) {\n      this.selectStudent(row);\n    },\n    // 历史记录分页切换\n    handleHistoryPageChange(pageNum) {\n      this.historyPageNum = pageNum;\n      this.loadHistoryBorrows();\n    },\n    // 历史记录每页条数切换\n    handleHistorySizeChange(pageSize) {\n      this.historyPageSize = pageSize;\n      this.historyPageNum = 1;\n      this.loadHistoryBorrows();\n    },\n    // 工具方法：格式化日期\n    formatDate(dateStr) {\n      if (!dateStr) return '--';\n      try {\n        const date = new Date(dateStr);\n        return date.toLocaleDateString('zh-CN', {\n          year: 'numeric',\n          month: '2-digit',\n          day: '2-digit'\n        }).replace(/\\//g, '-');\n      } catch (e) {\n        return dateStr;\n      }\n    },\n    // 判断是否超期\n    isOverdue(record) {\n      if (!record.dueTime || record.returnTime) return false;\n      const dueDate = new Date(record.dueTime);\n      const now = new Date();\n      return now > dueDate;\n    },\n    // 计算超期天数\n    calculateOverdueDays(record) {\n      if (!this.isOverdue(record)) return 0;\n      const dueDate = new Date(record.dueTime);\n      const now = new Date();\n      const diffTime = now - dueDate;\n      return Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n    },\n    // 计算剩余天数\n    calculateRemainingDays(record) {\n      if (!record.dueTime || this.isOverdue(record)) return 0;\n      const dueDate = new Date(record.dueTime);\n      const now = new Date();\n      const diffTime = dueDate - now;\n      return Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n    },\n    // 获取剩余天数标签类型\n    getRemainingDaysTagType(record) {\n      const days = this.calculateRemainingDays(record);\n      if (days <= 0) return 'danger';\n      if (days <= 3) return 'warning';\n      return 'success';\n    },\n    // 计算借阅时长\n    calculateBorrowDuration(record) {\n      if (!record.borrowTime) return '--';\n      const borrowDate = new Date(record.borrowTime);\n      const returnDate = record.returnTime ? new Date(record.returnTime) : new Date();\n      const diffTime = returnDate - borrowDate;\n      const days = Math.floor(diffTime / (1000 * 60 * 60 * 24));\n      return days > 0 ? `${days}天` : '当天归还';\n    }\n  }\n};","map":{"version":3,"names":["name","data","searchInput","searchType","currentStudent","borrowStats","totalBorrowed","currentBorrowing","overdue","currentBorrowList","loadingCurrent","selectedCurrentBorrows","historyBorrowList","loadingHistory","historyPageNum","historyPageSize","historyTotal","studentListVisible","studentListSearch","studentList","computed","filteredStudentList","search","toLowerCase","filter","student","studentId","includes","phone","methods","handleSearch","trim","$message","warning","console","log","params","pageNum","pageSize","$request","get","then","res","code","list","length","selectStudent","catch","err","error","handleSearchTypeChange","info","showStudentList","resetSearch","loadBorrowData","id","loadCurrentBorrows","loadHistoryBorrows","calculateBorrowStats","allBorrows","forEach","record","index","图书","bookName","借阅时间","borrowTime","归还时间","returnTime","应还时间","dueTime","是否有returnTime","returnTime值","currentBorrows","hasReturnTime","undefined","returnLoading","warn","msg","userId","total","isOverdue","handleCurrentBorrowSelection","selection","handleSingleReturn","$confirm","confirmButtonText","cancelButtonText","type","user","JSON","parse","localStorage","getItem","adminId","borrowId","post","success","message","handleBatchReturn","bookNames","map","item","join","successCount","failCount","handleStudentSelect","row","handleHistoryPageChange","handleHistorySizeChange","formatDate","dateStr","date","Date","toLocaleDateString","year","month","day","replace","e","dueDate","now","calculateOverdueDays","diffTime","Math","ceil","calculateRemainingDays","getRemainingDaysTagType","days","calculateBorrowDuration","borrowDate","returnDate","floor"],"sources":["src/views/manager/StudentBorrowQuery.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <!-- 1. 学生搜索区 -->\r\n    <el-card shadow=\"hover\" style=\"margin-bottom: 20px;\">\r\n      <div slot=\"header\" class=\"clearfix\">\r\n        <span style=\"font-weight: bold; color: #409EFF;\">\r\n          <i class=\"el-icon-search\"></i> 学生查询\r\n        </span>\r\n      </div>\r\n\r\n      <div class=\"search-container\">\r\n        <div style=\"display: flex; align-items: center; gap: 15px;\">\r\n          <div style=\"flex: 1;\">\r\n            <el-input\r\n                v-model=\"searchInput\"\r\n                placeholder=\"请输入学生学号、姓名进行查询\"\r\n                style=\"width: 100%\"\r\n                @keyup.enter.native=\"handleSearch\"\r\n                clearable>\r\n              <el-select\r\n                  v-model=\"searchType\"\r\n                  slot=\"prepend\"\r\n                  style=\"width: 100px\"\r\n                  @change=\"handleSearchTypeChange\">\r\n                <el-option label=\"学号\" value=\"studentId\"></el-option>\r\n                <el-option label=\"姓名\" value=\"name\"></el-option>\r\n              </el-select>\r\n              <el-button\r\n                  slot=\"append\"\r\n                  icon=\"el-icon-search\"\r\n                  type=\"primary\"\r\n                  @click=\"handleSearch\">\r\n              </el-button>\r\n            </el-input>\r\n          </div>\r\n\r\n          <div>\r\n            <el-button type=\"info\" plain @click=\"showStudentList\">\r\n              <i class=\"el-icon-user\"></i> 学生列表\r\n            </el-button>\r\n            <el-button type=\"warning\" plain @click=\"resetSearch\">\r\n              <i class=\"el-icon-refresh\"></i> 重置\r\n            </el-button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </el-card>\r\n\r\n    <!-- 2. 学生信息展示区 -->\r\n    <el-card v-if=\"currentStudent.id\" shadow=\"hover\" style=\"margin-bottom: 20px;\">\r\n      <div slot=\"header\" class=\"clearfix\">\r\n        <span style=\"font-weight: bold; color: #67C23A;\">\r\n          <i class=\"el-icon-user-solid\"></i> 学生信息\r\n        </span>\r\n      </div>\r\n\r\n      <div class=\"student-info\">\r\n        <div style=\"display: flex; align-items: center; margin-bottom: 15px;\">\r\n          <div style=\"width: 80px; height: 80px; background-color: #f0f9ff; border-radius: 50%;\r\n                     display: flex; align-items: center; justify-content: center; margin-right: 20px;\">\r\n            <i class=\"el-icon-user\" style=\"font-size: 40px; color: #409EFF;\"></i>\r\n          </div>\r\n\r\n          <div style=\"flex: 1;\">\r\n            <div style=\"display: flex; flex-wrap: wrap; gap: 30px;\">\r\n              <div class=\"info-item\">\r\n                <div class=\"info-label\">学号</div>\r\n                <div class=\"info-value\">{{ currentStudent.studentId || currentStudent.id }}</div>\r\n              </div>\r\n              <div class=\"info-item\">\r\n                <div class=\"info-label\">姓名</div>\r\n                <div class=\"info-value\">{{ currentStudent.name }}</div>\r\n              </div>\r\n              <div class=\"info-item\">\r\n                <div class=\"info-label\">联系方式</div>\r\n                <div class=\"info-value\">{{ currentStudent.phone || '未填写' }}</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- 借阅统计卡片 -->\r\n        <div style=\"display: flex; gap: 15px; margin-top: 10px;\">\r\n          <el-card shadow=\"never\" style=\"flex: 1; text-align: center; background-color: #f0f9ff;\">\r\n            <div style=\"color: #409EFF; font-size: 24px; font-weight: bold;\">\r\n              {{ borrowStats.totalBorrowed || 0 }}\r\n            </div>\r\n            <div style=\"color: #606266; font-size: 14px; margin-top: 5px;\">总借阅量</div>\r\n          </el-card>\r\n          <el-card shadow=\"never\" style=\"flex: 1; text-align: center; background-color: #f0f9ff;\">\r\n            <div style=\"color: #E6A23C; font-size: 24px; font-weight: bold;\">\r\n              {{ borrowStats.currentBorrowing || 0 }}\r\n            </div>\r\n            <div style=\"color: #606266; font-size: 14px; margin-top: 5px;\">当前借阅</div>\r\n          </el-card>\r\n          <el-card shadow=\"never\" style=\"flex: 1; text-align: center; background-color: #f0f9ff;\">\r\n            <div :style=\"{color: borrowStats.overdue > 0 ? '#F56C6C' : '#67C23A',\r\n                         fontSize: '24px', fontWeight: 'bold'}\">\r\n              {{ borrowStats.overdue || 0 }}\r\n            </div>\r\n            <div style=\"color: #606266; font-size: 14px; margin-top: 5px;\">超期未还</div>\r\n          </el-card>\r\n        </div>\r\n      </div>\r\n    </el-card>\r\n\r\n    <!-- 3. 当前借阅列表 -->\r\n    <el-card v-if=\"currentStudent.id\" shadow=\"hover\" style=\"margin-bottom: 20px;\">\r\n      <div slot=\"header\" class=\"clearfix\">\r\n        <span style=\"font-weight: bold; color: #E6A23C;\">\r\n          <i class=\"el-icon-reading\"></i> 当前借阅 ({{ currentBorrowList.length }})\r\n        </span>\r\n        <div style=\"float: right;\">\r\n          <el-button\r\n              type=\"success\"\r\n              size=\"mini\"\r\n              plain\r\n              :disabled=\"selectedCurrentBorrows.length === 0\"\r\n              @click=\"handleBatchReturn\">\r\n            批量归还 ({{ selectedCurrentBorrows.length }})\r\n          </el-button>\r\n          <el-button\r\n              type=\"primary\"\r\n              size=\"mini\"\r\n              plain\r\n              @click=\"loadBorrowData\">\r\n            <i class=\"el-icon-refresh\"></i> 刷新\r\n          </el-button>\r\n        </div>\r\n      </div>\r\n\r\n      <div v-if=\"currentBorrowList.length > 0\">\r\n        <el-table\r\n            :data=\"currentBorrowList\"\r\n            stripe\r\n            @selection-change=\"handleCurrentBorrowSelection\"\r\n            v-loading=\"loadingCurrent\">\r\n\r\n          <el-table-column type=\"selection\" width=\"55\" align=\"center\"></el-table-column>\r\n\r\n          <el-table-column label=\"图书信息\" min-width=\"200\">\r\n            <template v-slot=\"scope\">\r\n              <div>\r\n                <div style=\"font-weight: 500; color: #409EFF;\">{{ scope.row.bookName }}</div>\r\n                <div style=\"font-size: 12px; color: #909399; margin-top: 2px;\">\r\n                  {{ scope.row.bookAuthor }} | ISBN: {{ scope.row.bookIsbn }}\r\n                </div>\r\n              </div>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"借阅时间\" width=\"150\" align=\"center\">\r\n            <template v-slot=\"scope\">\r\n              {{ formatDate(scope.row.borrowTime) }}\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"应还时间\" width=\"150\" align=\"center\">\r\n            <template v-slot=\"scope\">\r\n              <div :style=\"{color: isOverdue(scope.row) ? '#F56C6C' : '#67C23A'}\">\r\n                {{ formatDate(scope.row.dueTime) }}\r\n              </div>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"剩余天数\" width=\"100\" align=\"center\">\r\n            <template v-slot=\"scope\">\r\n              <el-tag\r\n                  :type=\"getRemainingDaysTagType(scope.row)\"\r\n                  size=\"small\"\r\n                  effect=\"plain\">\r\n                {{ calculateRemainingDays(scope.row) }}天\r\n              </el-tag>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"超期状态\" width=\"100\" align=\"center\">\r\n            <template v-slot=\"scope\">\r\n              <el-tag\r\n                  v-if=\"isOverdue(scope.row)\"\r\n                  type=\"danger\"\r\n                  size=\"small\"\r\n                  effect=\"dark\">\r\n                超期 {{ calculateOverdueDays(scope.row) }}天\r\n              </el-tag>\r\n              <el-tag\r\n                  v-else\r\n                  type=\"success\"\r\n                  size=\"small\"\r\n                  effect=\"plain\">\r\n                正常\r\n              </el-tag>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"操作\" width=\"120\" align=\"center\" fixed=\"right\">\r\n            <template v-slot=\"scope\">\r\n              <el-button\r\n                  type=\"success\"\r\n                  size=\"mini\"\r\n                  @click=\"handleSingleReturn(scope.row)\"\r\n                  :loading=\"scope.row.returnLoading\">\r\n                归还\r\n              </el-button>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n      </div>\r\n\r\n      <div v-else style=\"text-align: center; padding: 40px; color: #909399;\">\r\n        <i class=\"el-icon-notebook-2\" style=\"font-size: 60px; margin-bottom: 15px;\"></i>\r\n        <div style=\"font-size: 16px;\">该学生当前没有借阅中的图书</div>\r\n      </div>\r\n    </el-card>\r\n\r\n    <!-- 4. 历史借阅记录 -->\r\n    <el-card v-if=\"currentStudent.id\" shadow=\"hover\">\r\n      <div slot=\"header\" class=\"clearfix\">\r\n        <span style=\"font-weight: bold; color: #909399;\">\r\n          <i class=\"el-icon-timer\"></i> 历史借阅记录\r\n        </span>\r\n      </div>\r\n\r\n      <div v-if=\"historyBorrowList.length > 0\">\r\n        <el-table\r\n            :data=\"historyBorrowList\"\r\n            stripe\r\n            v-loading=\"loadingHistory\">\r\n\r\n          <el-table-column label=\"图书信息\" min-width=\"200\">\r\n            <template v-slot=\"scope\">\r\n              <div>\r\n                <div style=\"font-weight: 500;\">{{ scope.row.bookName }}</div>\r\n                <div style=\"font-size: 12px; color: #909399; margin-top: 2px;\">\r\n                  {{ scope.row.bookAuthor }} | ISBN: {{ scope.row.bookIsbn }}\r\n                </div>\r\n              </div>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"借阅时间\" width=\"150\" align=\"center\">\r\n            <template v-slot=\"scope\">\r\n              {{ formatDate(scope.row.borrowTime) }}\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"归还时间\" width=\"150\" align=\"center\">\r\n            <template v-slot=\"scope\">\r\n              {{ formatDate(scope.row.returnTime) || '--' }}\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"借阅状态\" width=\"100\" align=\"center\">\r\n            <template v-slot=\"scope\">\r\n              <el-tag\r\n                  :type=\"scope.row.returnTime ? 'success' : 'warning'\"\r\n                  size=\"small\">\r\n                {{ scope.row.returnTime ? '已归还' : '借阅中' }}\r\n              </el-tag>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"借阅时长\" width=\"120\" align=\"center\">\r\n            <template v-slot=\"scope\">\r\n              {{ calculateBorrowDuration(scope.row) }}\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n\r\n        <!-- 历史记录分页 -->\r\n        <div style=\"margin-top: 15px; text-align: center;\">\r\n          <el-pagination\r\n              background\r\n              @current-change=\"handleHistoryPageChange\"\r\n              @size-change=\"handleHistorySizeChange\"\r\n              :current-page=\"historyPageNum\"\r\n              :page-sizes=\"[10, 20, 50]\"\r\n              :page-size=\"historyPageSize\"\r\n              layout=\"total, sizes, prev, pager, next\"\r\n              :total=\"historyTotal\">\r\n          </el-pagination>\r\n        </div>\r\n      </div>\r\n\r\n      <div v-else style=\"text-align: center; padding: 40px; color: #909399;\">\r\n        <i class=\"el-icon-document\" style=\"font-size: 60px; margin-bottom: 15px;\"></i>\r\n        <div style=\"font-size: 16px;\">暂无历史借阅记录</div>\r\n      </div>\r\n    </el-card>\r\n\r\n    <!-- 5. 学生选择对话框 -->\r\n    <el-dialog\r\n        title=\"选择学生\"\r\n        :visible.sync=\"studentListVisible\"\r\n        width=\"70%\"\r\n        :close-on-click-modal=\"false\">\r\n\r\n      <div style=\"margin-bottom: 15px;\">\r\n        <el-input\r\n            v-model=\"studentListSearch\"\r\n            placeholder=\"搜索学生\"\r\n            style=\"width: 300px\"\r\n            clearable>\r\n          <el-button slot=\"append\" icon=\"el-icon-search\"></el-button>\r\n        </el-input>\r\n      </div>\r\n\r\n      <el-table\r\n          :data=\"filteredStudentList\"\r\n          stripe\r\n          @row-click=\"handleStudentSelect\"\r\n          height=\"400\">\r\n\r\n        <el-table-column prop=\"studentId\" label=\"学号\" width=\"120\" align=\"center\"></el-table-column>\r\n        <el-table-column prop=\"name\" label=\"姓名\" width=\"100\" align=\"center\"></el-table-column>\r\n        <el-table-column prop=\"phone\" label=\"联系方式\" width=\"120\"></el-table-column>\r\n        <el-table-column label=\"操作\" width=\"80\" align=\"center\">\r\n          <template v-slot=\"scope\">\r\n            <el-button type=\"text\" size=\"mini\" @click.stop=\"selectStudent(scope.row)\">选择</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"studentListVisible = false\">取消</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"StudentBorrowQuery\",\r\n  data() {\r\n    return {\r\n      // 搜索相关\r\n      searchInput: '',\r\n      searchType: 'studentId',\r\n\r\n      // 当前学生信息\r\n      currentStudent: {},\r\n\r\n      // 借阅统计\r\n      borrowStats: {\r\n        totalBorrowed: 0,\r\n        currentBorrowing: 0,\r\n        overdue: 0\r\n      },\r\n\r\n      // 当前借阅列表\r\n      currentBorrowList: [],\r\n      loadingCurrent: false,\r\n      selectedCurrentBorrows: [],\r\n\r\n      // 历史借阅记录\r\n      historyBorrowList: [],\r\n      loadingHistory: false,\r\n      historyPageNum: 1,\r\n      historyPageSize: 10,\r\n      historyTotal: 0,\r\n\r\n      // 学生列表对话框\r\n      studentListVisible: false,\r\n      studentListSearch: '',\r\n      studentList: []\r\n    }\r\n  },\r\n  computed: {\r\n    // 过滤后的学生列表\r\n    filteredStudentList() {\r\n      if (!this.studentListSearch) return this.studentList\r\n\r\n      const search = this.studentListSearch.toLowerCase()\r\n      return this.studentList.filter(student =>\r\n          (student.studentId && student.studentId.toLowerCase().includes(search)) ||\r\n          (student.name && student.name.toLowerCase().includes(search)) ||\r\n          (student.phone && student.phone.includes(search))\r\n      )\r\n    }\r\n  },\r\n  methods: {\r\n    // 搜索学生\r\n    handleSearch() {\r\n      if (!this.searchInput.trim()) {\r\n        this.$message.warning('请输入搜索内容')\r\n        return\r\n      }\r\n\r\n      console.log('搜索学生，类型:', this.searchType, '关键词:', this.searchInput)\r\n\r\n      // 构建查询参数\r\n      const params = {\r\n        pageNum: 1,\r\n        pageSize: 10\r\n      }\r\n\r\n      // 根据搜索类型设置参数\r\n      if (this.searchType === 'studentId') {\r\n        params.studentId = this.searchInput\r\n      } else if (this.searchType === 'name') {\r\n        params.name = this.searchInput\r\n      }\r\n\r\n      this.$request.get('/user/selectPage', {\r\n        params: params\r\n      }).then(res => {\r\n        console.log('学生搜索响应:', res)\r\n        if (res.code === '200' && res.data?.list?.length > 0) {\r\n          // 如果有多个结果，显示选择对话框\r\n          if (res.data.list.length > 1) {\r\n            this.studentList = res.data.list\r\n            this.studentListVisible = true\r\n          } else {\r\n            // 只有一个结果，直接选择\r\n            this.selectStudent(res.data.list[0])\r\n          }\r\n        } else {\r\n          this.$message.warning('未找到匹配的学生')\r\n        }\r\n      }).catch(err => {\r\n        console.error('搜索学生出错:', err)\r\n        this.$message.error('搜索失败，请检查网络连接')\r\n      })\r\n    },\r\n\r\n    // 切换搜索类型\r\n    handleSearchTypeChange() {\r\n      this.searchInput = ''\r\n      this.$message.info(`已切换为按${this.searchType === 'studentId' ? '学号' : '姓名'}搜索`)\r\n    },\r\n\r\n    // 显示学生列表\r\n    showStudentList() {\r\n      // 加载所有学生\r\n      this.$request.get('/user/selectPage', {\r\n        params: {\r\n          pageNum: 1,\r\n          pageSize: 100\r\n        }\r\n      }).then(res => {\r\n        if (res.code === '200' && res.data?.list) {\r\n          this.studentList = res.data.list\r\n          this.studentListVisible = true\r\n        } else {\r\n          this.$message.warning('获取学生列表失败')\r\n        }\r\n      })\r\n    },\r\n\r\n    // 重置搜索\r\n    resetSearch() {\r\n      this.searchInput = ''\r\n      this.currentStudent = {}\r\n      this.currentBorrowList = []\r\n      this.historyBorrowList = []\r\n      this.borrowStats = {\r\n        totalBorrowed: 0,\r\n        currentBorrowing: 0,\r\n        overdue: 0\r\n      }\r\n    },\r\n\r\n    // 选择学生\r\n    selectStudent(student) {\r\n      console.log('选择学生:', student)\r\n      this.currentStudent = student\r\n      this.studentListVisible = false\r\n\r\n      // 加载该学生的借阅数据\r\n      this.loadBorrowData()\r\n    },\r\n\r\n    // 加载借阅数据\r\n    loadBorrowData() {\r\n      if (!this.currentStudent.id) {\r\n        this.$message.warning('请先选择学生')\r\n        return\r\n      }\r\n\r\n      console.log('加载学生借阅数据，学生ID:', this.currentStudent.id)\r\n      this.loadCurrentBorrows()\r\n      this.loadHistoryBorrows()\r\n      this.calculateBorrowStats()\r\n    },\r\n\r\n    // 加载当前借阅\r\n    async loadCurrentBorrows() {\r\n      this.loadingCurrent = true\r\n      console.log('开始加载当前借阅，学生ID:', this.currentStudent.id)\r\n\r\n      try {\r\n        // 方案1：调用专用接口获取该学生的借阅记录\r\n        const res = await this.$request.get(`/book/borrow/user/${this.currentStudent.id}`)\r\n        console.log('当前借阅接口响应:', res)\r\n\r\n        if (res.code === '200') {\r\n          const allBorrows = res.data || []\r\n          console.log('所有借阅记录:', allBorrows)\r\n\r\n          // 重要：打印每条记录的状态信息，用于调试\r\n          allBorrows.forEach((record, index) => {\r\n            console.log(`记录${index}:`, {\r\n              id: record.id,\r\n              图书: record.bookName,\r\n              借阅时间: record.borrowTime,\r\n              归还时间: record.returnTime,\r\n              应还时间: record.dueTime,\r\n              是否有returnTime: !!record.returnTime,\r\n              returnTime值: record.returnTime\r\n            })\r\n          })\r\n\r\n          // 过滤出未归还的记录\r\n          // 关键：正确的过滤逻辑应该是 returnTime 为空、null 或 undefined\r\n          const currentBorrows = allBorrows.filter(record => {\r\n            // 多个条件判断，确保不会误判\r\n            const hasReturnTime = record.returnTime !== null &&\r\n                record.returnTime !== undefined &&\r\n                record.returnTime !== ''\r\n\r\n            console.log(`记录 ${record.id} 的 returnTime: \"${record.returnTime}\"`,\r\n                `是否视为已归还: ${hasReturnTime}`)\r\n\r\n            return !hasReturnTime\r\n          })\r\n\r\n          console.log('筛选后的当前借阅记录:', currentBorrows)\r\n          console.log('筛选前总数:', allBorrows.length, '筛选后:', currentBorrows.length)\r\n\r\n          this.currentBorrowList = currentBorrows\r\n          this.selectedCurrentBorrows = []\r\n\r\n          // 为每条记录添加加载状态\r\n          this.currentBorrowList.forEach(record => {\r\n            record.returnLoading = false\r\n          })\r\n\r\n          // 如果没有找到当前借阅，显示提示信息\r\n          if (currentBorrows.length === 0 && allBorrows.length > 0) {\r\n            console.warn('警告：有历史借阅记录，但没有当前借阅记录')\r\n            console.warn('可能原因：所有记录的returnTime都有值')\r\n          }\r\n        } else {\r\n          console.error('获取当前借阅失败:', res.msg)\r\n          this.$message.error(res.msg || '获取当前借阅失败')\r\n          this.currentBorrowList = []\r\n        }\r\n      } catch (error) {\r\n        console.error('获取当前借阅出错:', error)\r\n        this.$message.error('获取当前借阅失败，请检查网络连接')\r\n        this.currentBorrowList = []\r\n      } finally {\r\n        this.loadingCurrent = false\r\n      }\r\n    },\r\n\r\n    // 加载历史借阅记录\r\n    loadHistoryBorrows() {\r\n      this.loadingHistory = true\r\n\r\n      // 调用分页查询接口\r\n      this.$request.get('/book/borrow/selectPage', {\r\n        params: {\r\n          pageNum: this.historyPageNum,\r\n          pageSize: this.historyPageSize,\r\n          userId: this.currentStudent.id\r\n        }\r\n      }).then(res => {\r\n        this.loadingHistory = false\r\n        if (res.code === '200') {\r\n          this.historyBorrowList = res.data?.list || []\r\n          this.historyTotal = res.data?.total || 0\r\n        } else {\r\n          this.$message.error(res.msg || '获取历史记录失败')\r\n        }\r\n      }).catch(err => {\r\n        this.loadingHistory = false\r\n        console.error('获取历史记录出错:', err)\r\n      })\r\n    },\r\n\r\n    // 计算借阅统计\r\n    calculateBorrowStats() {\r\n      this.borrowStats = {\r\n        totalBorrowed: this.historyTotal,\r\n        currentBorrowing: this.currentBorrowList.length,\r\n        overdue: this.currentBorrowList.filter(record => this.isOverdue(record)).length\r\n      }\r\n    },\r\n\r\n    // 当前借阅多选\r\n    handleCurrentBorrowSelection(selection) {\r\n      this.selectedCurrentBorrows = selection\r\n    },\r\n\r\n    // 单本归还\r\n    async handleSingleReturn(record) {\r\n      console.log('单本归还，记录:', record)\r\n\r\n      try {\r\n        // 设置加载状态\r\n        record.returnLoading = true\r\n\r\n        await this.$confirm(`确认归还图书《${record.bookName}》吗？`, '办理归还', {\r\n          confirmButtonText: '确认归还',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        })\r\n\r\n        // 获取当前管理员ID（从登录信息获取）\r\n        const user = JSON.parse(localStorage.getItem(\"xm-user\") || '{}')\r\n        const adminId = user.id\r\n\r\n        if (!adminId) {\r\n          this.$message.error('无法获取管理员信息，请重新登录')\r\n          record.returnLoading = false\r\n          return\r\n        }\r\n\r\n        console.log('归还参数:', {\r\n          borrowId: record.id,\r\n          adminId: adminId\r\n        })\r\n\r\n        // 调用归还接口\r\n        const res = await this.$request.post(`/book/return/${record.id}`, null, {\r\n          params: { adminId }\r\n        })\r\n\r\n        console.log('归还响应:', res)\r\n\r\n        if (res.code === '200') {\r\n          this.$message.success('归还成功')\r\n          // 重新加载所有数据\r\n          this.loadBorrowData()\r\n        } else {\r\n          this.$message.error(res.msg || '归还失败')\r\n          record.returnLoading = false\r\n        }\r\n      } catch (error) {\r\n        console.log('取消操作或操作失败:', error)\r\n        record.returnLoading = false\r\n\r\n        // 如果是用户取消操作，不做处理\r\n        if (error !== 'cancel' && error.message !== 'cancel') {\r\n          this.$message.error('操作失败: ' + (error.message || '未知错误'))\r\n        }\r\n      }\r\n    },\r\n\r\n    // 批量归还\r\n    async handleBatchReturn() {\r\n      if (this.selectedCurrentBorrows.length === 0) {\r\n        this.$message.warning('请选择要归还的图书')\r\n        return\r\n      }\r\n\r\n      const bookNames = this.selectedCurrentBorrows.map(item => item.bookName).join('、')\r\n\r\n      try {\r\n        await this.$confirm(`确认批量归还 ${this.selectedCurrentBorrows.length} 本图书吗？\\n\\n${bookNames}`, '批量归还', {\r\n          confirmButtonText: '确认归还',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        })\r\n\r\n        // 获取当前管理员ID\r\n        const user = JSON.parse(localStorage.getItem(\"xm-user\") || '{}')\r\n        const adminId = user.id\r\n\r\n        if (!adminId) {\r\n          this.$message.error('无法获取管理员信息')\r\n          return\r\n        }\r\n\r\n        let successCount = 0\r\n        let failCount = 0\r\n\r\n        // 为选中的记录添加加载状态\r\n        this.selectedCurrentBorrows.forEach(record => {\r\n          record.returnLoading = true\r\n        })\r\n\r\n        // 逐个处理归还\r\n        for (const record of this.selectedCurrentBorrows) {\r\n          try {\r\n            const res = await this.$request.post(`/book/return/${record.id}`, null, {\r\n              params: { adminId }\r\n            })\r\n\r\n            if (res.code === '200') {\r\n              successCount++\r\n            } else {\r\n              failCount++\r\n              console.error(`归还 ${record.bookName} 失败:`, res.msg)\r\n            }\r\n          } catch (error) {\r\n            failCount++\r\n            console.error(`归还 ${record.bookName} 异常:`, error)\r\n          }\r\n        }\r\n\r\n        // 清除加载状态\r\n        this.selectedCurrentBorrows.forEach(record => {\r\n          record.returnLoading = false\r\n        })\r\n\r\n        // 显示结果\r\n        let message = ''\r\n        if (successCount > 0) {\r\n          message += `成功归还 ${successCount} 本图书`\r\n        }\r\n        if (failCount > 0) {\r\n          message += `，失败 ${failCount} 本`\r\n        }\r\n\r\n        if (message) {\r\n          this.$message.success(message)\r\n        }\r\n\r\n        // 刷新数据\r\n        this.loadBorrowData()\r\n        this.selectedCurrentBorrows = []\r\n\r\n      } catch (error) {\r\n        console.log('取消批量归还操作')\r\n\r\n        // 清除加载状态\r\n        this.selectedCurrentBorrows.forEach(record => {\r\n          record.returnLoading = false\r\n        })\r\n      }\r\n    },\r\n\r\n    // 学生列表行点击\r\n    handleStudentSelect(row) {\r\n      this.selectStudent(row)\r\n    },\r\n\r\n    // 历史记录分页切换\r\n    handleHistoryPageChange(pageNum) {\r\n      this.historyPageNum = pageNum\r\n      this.loadHistoryBorrows()\r\n    },\r\n\r\n    // 历史记录每页条数切换\r\n    handleHistorySizeChange(pageSize) {\r\n      this.historyPageSize = pageSize\r\n      this.historyPageNum = 1\r\n      this.loadHistoryBorrows()\r\n    },\r\n\r\n    // 工具方法：格式化日期\r\n    formatDate(dateStr) {\r\n      if (!dateStr) return '--'\r\n      try {\r\n        const date = new Date(dateStr)\r\n        return date.toLocaleDateString('zh-CN', {\r\n          year: 'numeric',\r\n          month: '2-digit',\r\n          day: '2-digit'\r\n        }).replace(/\\//g, '-')\r\n      } catch (e) {\r\n        return dateStr\r\n      }\r\n    },\r\n\r\n    // 判断是否超期\r\n    isOverdue(record) {\r\n      if (!record.dueTime || record.returnTime) return false\r\n\r\n      const dueDate = new Date(record.dueTime)\r\n      const now = new Date()\r\n      return now > dueDate\r\n    },\r\n\r\n    // 计算超期天数\r\n    calculateOverdueDays(record) {\r\n      if (!this.isOverdue(record)) return 0\r\n\r\n      const dueDate = new Date(record.dueTime)\r\n      const now = new Date()\r\n      const diffTime = now - dueDate\r\n      return Math.ceil(diffTime / (1000 * 60 * 60 * 24))\r\n    },\r\n\r\n    // 计算剩余天数\r\n    calculateRemainingDays(record) {\r\n      if (!record.dueTime || this.isOverdue(record)) return 0\r\n\r\n      const dueDate = new Date(record.dueTime)\r\n      const now = new Date()\r\n      const diffTime = dueDate - now\r\n      return Math.ceil(diffTime / (1000 * 60 * 60 * 24))\r\n    },\r\n\r\n    // 获取剩余天数标签类型\r\n    getRemainingDaysTagType(record) {\r\n      const days = this.calculateRemainingDays(record)\r\n      if (days <= 0) return 'danger'\r\n      if (days <= 3) return 'warning'\r\n      return 'success'\r\n    },\r\n\r\n    // 计算借阅时长\r\n    calculateBorrowDuration(record) {\r\n      if (!record.borrowTime) return '--'\r\n\r\n      const borrowDate = new Date(record.borrowTime)\r\n      const returnDate = record.returnTime ? new Date(record.returnTime) : new Date()\r\n      const diffTime = returnDate - borrowDate\r\n      const days = Math.floor(diffTime / (1000 * 60 * 60 * 24))\r\n\r\n      return days > 0 ? `${days}天` : '当天归还'\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.search-container {\r\n  padding: 10px;\r\n}\r\n\r\n.student-info {\r\n  padding: 10px;\r\n}\r\n\r\n.info-item {\r\n  margin-bottom: 10px;\r\n  min-width: 150px;\r\n}\r\n\r\n.info-label {\r\n  font-size: 12px;\r\n  color: #909399;\r\n  margin-bottom: 4px;\r\n}\r\n\r\n.info-value {\r\n  font-size: 16px;\r\n  font-weight: 500;\r\n  color: #303133;\r\n}\r\n\r\n/* 表格行悬停效果 */\r\n.el-table >>> tbody tr:hover {\r\n  cursor: pointer;\r\n}\r\n\r\n/* 卡片标题样式 */\r\n.el-card__header {\r\n  background-color: #fafafa;\r\n  border-bottom: 1px solid #ebeef5;\r\n}\r\n\r\n/* 响应式调整 */\r\n@media (max-width: 768px) {\r\n  .search-container > div {\r\n    flex-direction: column;\r\n  }\r\n\r\n  .info-item {\r\n    min-width: 100%;\r\n  }\r\n}\r\n</style>"],"mappings":"AA2UA;EACAA,IAAA;EACAC,KAAA;IACA;MACA;MACAC,WAAA;MACAC,UAAA;MAEA;MACAC,cAAA;MAEA;MACAC,WAAA;QACAC,aAAA;QACAC,gBAAA;QACAC,OAAA;MACA;MAEA;MACAC,iBAAA;MACAC,cAAA;MACAC,sBAAA;MAEA;MACAC,iBAAA;MACAC,cAAA;MACAC,cAAA;MACAC,eAAA;MACAC,YAAA;MAEA;MACAC,kBAAA;MACAC,iBAAA;MACAC,WAAA;IACA;EACA;EACAC,QAAA;IACA;IACAC,oBAAA;MACA,UAAAH,iBAAA,cAAAC,WAAA;MAEA,MAAAG,MAAA,QAAAJ,iBAAA,CAAAK,WAAA;MACA,YAAAJ,WAAA,CAAAK,MAAA,CAAAC,OAAA,IACAA,OAAA,CAAAC,SAAA,IAAAD,OAAA,CAAAC,SAAA,CAAAH,WAAA,GAAAI,QAAA,CAAAL,MAAA,KACAG,OAAA,CAAAzB,IAAA,IAAAyB,OAAA,CAAAzB,IAAA,CAAAuB,WAAA,GAAAI,QAAA,CAAAL,MAAA,KACAG,OAAA,CAAAG,KAAA,IAAAH,OAAA,CAAAG,KAAA,CAAAD,QAAA,CAAAL,MAAA,CACA;IACA;EACA;EACAO,OAAA;IACA;IACAC,aAAA;MACA,UAAA5B,WAAA,CAAA6B,IAAA;QACA,KAAAC,QAAA,CAAAC,OAAA;QACA;MACA;MAEAC,OAAA,CAAAC,GAAA,kBAAAhC,UAAA,eAAAD,WAAA;;MAEA;MACA,MAAAkC,MAAA;QACAC,OAAA;QACAC,QAAA;MACA;;MAEA;MACA,SAAAnC,UAAA;QACAiC,MAAA,CAAAV,SAAA,QAAAxB,WAAA;MACA,gBAAAC,UAAA;QACAiC,MAAA,CAAApC,IAAA,QAAAE,WAAA;MACA;MAEA,KAAAqC,QAAA,CAAAC,GAAA;QACAJ,MAAA,EAAAA;MACA,GAAAK,IAAA,CAAAC,GAAA;QACAR,OAAA,CAAAC,GAAA,YAAAO,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA,cAAAD,GAAA,CAAAzC,IAAA,EAAA2C,IAAA,EAAAC,MAAA;UACA;UACA,IAAAH,GAAA,CAAAzC,IAAA,CAAA2C,IAAA,CAAAC,MAAA;YACA,KAAA1B,WAAA,GAAAuB,GAAA,CAAAzC,IAAA,CAAA2C,IAAA;YACA,KAAA3B,kBAAA;UACA;YACA;YACA,KAAA6B,aAAA,CAAAJ,GAAA,CAAAzC,IAAA,CAAA2C,IAAA;UACA;QACA;UACA,KAAAZ,QAAA,CAAAC,OAAA;QACA;MACA,GAAAc,KAAA,CAAAC,GAAA;QACAd,OAAA,CAAAe,KAAA,YAAAD,GAAA;QACA,KAAAhB,QAAA,CAAAiB,KAAA;MACA;IACA;IAEA;IACAC,uBAAA;MACA,KAAAhD,WAAA;MACA,KAAA8B,QAAA,CAAAmB,IAAA,cAAAhD,UAAA;IACA;IAEA;IACAiD,gBAAA;MACA;MACA,KAAAb,QAAA,CAAAC,GAAA;QACAJ,MAAA;UACAC,OAAA;UACAC,QAAA;QACA;MACA,GAAAG,IAAA,CAAAC,GAAA;QACA,IAAAA,GAAA,CAAAC,IAAA,cAAAD,GAAA,CAAAzC,IAAA,EAAA2C,IAAA;UACA,KAAAzB,WAAA,GAAAuB,GAAA,CAAAzC,IAAA,CAAA2C,IAAA;UACA,KAAA3B,kBAAA;QACA;UACA,KAAAe,QAAA,CAAAC,OAAA;QACA;MACA;IACA;IAEA;IACAoB,YAAA;MACA,KAAAnD,WAAA;MACA,KAAAE,cAAA;MACA,KAAAK,iBAAA;MACA,KAAAG,iBAAA;MACA,KAAAP,WAAA;QACAC,aAAA;QACAC,gBAAA;QACAC,OAAA;MACA;IACA;IAEA;IACAsC,cAAArB,OAAA;MACAS,OAAA,CAAAC,GAAA,UAAAV,OAAA;MACA,KAAArB,cAAA,GAAAqB,OAAA;MACA,KAAAR,kBAAA;;MAEA;MACA,KAAAqC,cAAA;IACA;IAEA;IACAA,eAAA;MACA,UAAAlD,cAAA,CAAAmD,EAAA;QACA,KAAAvB,QAAA,CAAAC,OAAA;QACA;MACA;MAEAC,OAAA,CAAAC,GAAA,wBAAA/B,cAAA,CAAAmD,EAAA;MACA,KAAAC,kBAAA;MACA,KAAAC,kBAAA;MACA,KAAAC,oBAAA;IACA;IAEA;IACA,MAAAF,mBAAA;MACA,KAAA9C,cAAA;MACAwB,OAAA,CAAAC,GAAA,wBAAA/B,cAAA,CAAAmD,EAAA;MAEA;QACA;QACA,MAAAb,GAAA,cAAAH,QAAA,CAAAC,GAAA,2BAAApC,cAAA,CAAAmD,EAAA;QACArB,OAAA,CAAAC,GAAA,cAAAO,GAAA;QAEA,IAAAA,GAAA,CAAAC,IAAA;UACA,MAAAgB,UAAA,GAAAjB,GAAA,CAAAzC,IAAA;UACAiC,OAAA,CAAAC,GAAA,YAAAwB,UAAA;;UAEA;UACAA,UAAA,CAAAC,OAAA,EAAAC,MAAA,EAAAC,KAAA;YACA5B,OAAA,CAAAC,GAAA,MAAA2B,KAAA;cACAP,EAAA,EAAAM,MAAA,CAAAN,EAAA;cACAQ,EAAA,EAAAF,MAAA,CAAAG,QAAA;cACAC,IAAA,EAAAJ,MAAA,CAAAK,UAAA;cACAC,IAAA,EAAAN,MAAA,CAAAO,UAAA;cACAC,IAAA,EAAAR,MAAA,CAAAS,OAAA;cACAC,aAAA,IAAAV,MAAA,CAAAO,UAAA;cACAI,WAAA,EAAAX,MAAA,CAAAO;YACA;UACA;;UAEA;UACA;UACA,MAAAK,cAAA,GAAAd,UAAA,CAAAnC,MAAA,CAAAqC,MAAA;YACA;YACA,MAAAa,aAAA,GAAAb,MAAA,CAAAO,UAAA,aACAP,MAAA,CAAAO,UAAA,KAAAO,SAAA,IACAd,MAAA,CAAAO,UAAA;YAEAlC,OAAA,CAAAC,GAAA,OAAA0B,MAAA,CAAAN,EAAA,mBAAAM,MAAA,CAAAO,UAAA,KACA,YAAAM,aAAA;YAEA,QAAAA,aAAA;UACA;UAEAxC,OAAA,CAAAC,GAAA,gBAAAsC,cAAA;UACAvC,OAAA,CAAAC,GAAA,WAAAwB,UAAA,CAAAd,MAAA,UAAA4B,cAAA,CAAA5B,MAAA;UAEA,KAAApC,iBAAA,GAAAgE,cAAA;UACA,KAAA9D,sBAAA;;UAEA;UACA,KAAAF,iBAAA,CAAAmD,OAAA,CAAAC,MAAA;YACAA,MAAA,CAAAe,aAAA;UACA;;UAEA;UACA,IAAAH,cAAA,CAAA5B,MAAA,UAAAc,UAAA,CAAAd,MAAA;YACAX,OAAA,CAAA2C,IAAA;YACA3C,OAAA,CAAA2C,IAAA;UACA;QACA;UACA3C,OAAA,CAAAe,KAAA,cAAAP,GAAA,CAAAoC,GAAA;UACA,KAAA9C,QAAA,CAAAiB,KAAA,CAAAP,GAAA,CAAAoC,GAAA;UACA,KAAArE,iBAAA;QACA;MACA,SAAAwC,KAAA;QACAf,OAAA,CAAAe,KAAA,cAAAA,KAAA;QACA,KAAAjB,QAAA,CAAAiB,KAAA;QACA,KAAAxC,iBAAA;MACA;QACA,KAAAC,cAAA;MACA;IACA;IAEA;IACA+C,mBAAA;MACA,KAAA5C,cAAA;;MAEA;MACA,KAAA0B,QAAA,CAAAC,GAAA;QACAJ,MAAA;UACAC,OAAA,OAAAvB,cAAA;UACAwB,QAAA,OAAAvB,eAAA;UACAgE,MAAA,OAAA3E,cAAA,CAAAmD;QACA;MACA,GAAAd,IAAA,CAAAC,GAAA;QACA,KAAA7B,cAAA;QACA,IAAA6B,GAAA,CAAAC,IAAA;UACA,KAAA/B,iBAAA,GAAA8B,GAAA,CAAAzC,IAAA,EAAA2C,IAAA;UACA,KAAA5B,YAAA,GAAA0B,GAAA,CAAAzC,IAAA,EAAA+E,KAAA;QACA;UACA,KAAAhD,QAAA,CAAAiB,KAAA,CAAAP,GAAA,CAAAoC,GAAA;QACA;MACA,GAAA/B,KAAA,CAAAC,GAAA;QACA,KAAAnC,cAAA;QACAqB,OAAA,CAAAe,KAAA,cAAAD,GAAA;MACA;IACA;IAEA;IACAU,qBAAA;MACA,KAAArD,WAAA;QACAC,aAAA,OAAAU,YAAA;QACAT,gBAAA,OAAAE,iBAAA,CAAAoC,MAAA;QACArC,OAAA,OAAAC,iBAAA,CAAAe,MAAA,CAAAqC,MAAA,SAAAoB,SAAA,CAAApB,MAAA,GAAAhB;MACA;IACA;IAEA;IACAqC,6BAAAC,SAAA;MACA,KAAAxE,sBAAA,GAAAwE,SAAA;IACA;IAEA;IACA,MAAAC,mBAAAvB,MAAA;MACA3B,OAAA,CAAAC,GAAA,aAAA0B,MAAA;MAEA;QACA;QACAA,MAAA,CAAAe,aAAA;QAEA,WAAAS,QAAA,WAAAxB,MAAA,CAAAG,QAAA;UACAsB,iBAAA;UACAC,gBAAA;UACAC,IAAA;QACA;;QAEA;QACA,MAAAC,IAAA,GAAAC,IAAA,CAAAC,KAAA,CAAAC,YAAA,CAAAC,OAAA;QACA,MAAAC,OAAA,GAAAL,IAAA,CAAAlC,EAAA;QAEA,KAAAuC,OAAA;UACA,KAAA9D,QAAA,CAAAiB,KAAA;UACAY,MAAA,CAAAe,aAAA;UACA;QACA;QAEA1C,OAAA,CAAAC,GAAA;UACA4D,QAAA,EAAAlC,MAAA,CAAAN,EAAA;UACAuC,OAAA,EAAAA;QACA;;QAEA;QACA,MAAApD,GAAA,cAAAH,QAAA,CAAAyD,IAAA,iBAAAnC,MAAA,CAAAN,EAAA;UACAnB,MAAA;YAAA0D;UAAA;QACA;QAEA5D,OAAA,CAAAC,GAAA,UAAAO,GAAA;QAEA,IAAAA,GAAA,CAAAC,IAAA;UACA,KAAAX,QAAA,CAAAiE,OAAA;UACA;UACA,KAAA3C,cAAA;QACA;UACA,KAAAtB,QAAA,CAAAiB,KAAA,CAAAP,GAAA,CAAAoC,GAAA;UACAjB,MAAA,CAAAe,aAAA;QACA;MACA,SAAA3B,KAAA;QACAf,OAAA,CAAAC,GAAA,eAAAc,KAAA;QACAY,MAAA,CAAAe,aAAA;;QAEA;QACA,IAAA3B,KAAA,iBAAAA,KAAA,CAAAiD,OAAA;UACA,KAAAlE,QAAA,CAAAiB,KAAA,aAAAA,KAAA,CAAAiD,OAAA;QACA;MACA;IACA;IAEA;IACA,MAAAC,kBAAA;MACA,SAAAxF,sBAAA,CAAAkC,MAAA;QACA,KAAAb,QAAA,CAAAC,OAAA;QACA;MACA;MAEA,MAAAmE,SAAA,QAAAzF,sBAAA,CAAA0F,GAAA,CAAAC,IAAA,IAAAA,IAAA,CAAAtC,QAAA,EAAAuC,IAAA;MAEA;QACA,WAAAlB,QAAA,gBAAA1E,sBAAA,CAAAkC,MAAA,aAAAuD,SAAA;UACAd,iBAAA;UACAC,gBAAA;UACAC,IAAA;QACA;;QAEA;QACA,MAAAC,IAAA,GAAAC,IAAA,CAAAC,KAAA,CAAAC,YAAA,CAAAC,OAAA;QACA,MAAAC,OAAA,GAAAL,IAAA,CAAAlC,EAAA;QAEA,KAAAuC,OAAA;UACA,KAAA9D,QAAA,CAAAiB,KAAA;UACA;QACA;QAEA,IAAAuD,YAAA;QACA,IAAAC,SAAA;;QAEA;QACA,KAAA9F,sBAAA,CAAAiD,OAAA,CAAAC,MAAA;UACAA,MAAA,CAAAe,aAAA;QACA;;QAEA;QACA,WAAAf,MAAA,SAAAlD,sBAAA;UACA;YACA,MAAA+B,GAAA,cAAAH,QAAA,CAAAyD,IAAA,iBAAAnC,MAAA,CAAAN,EAAA;cACAnB,MAAA;gBAAA0D;cAAA;YACA;YAEA,IAAApD,GAAA,CAAAC,IAAA;cACA6D,YAAA;YACA;cACAC,SAAA;cACAvE,OAAA,CAAAe,KAAA,OAAAY,MAAA,CAAAG,QAAA,QAAAtB,GAAA,CAAAoC,GAAA;YACA;UACA,SAAA7B,KAAA;YACAwD,SAAA;YACAvE,OAAA,CAAAe,KAAA,OAAAY,MAAA,CAAAG,QAAA,QAAAf,KAAA;UACA;QACA;;QAEA;QACA,KAAAtC,sBAAA,CAAAiD,OAAA,CAAAC,MAAA;UACAA,MAAA,CAAAe,aAAA;QACA;;QAEA;QACA,IAAAsB,OAAA;QACA,IAAAM,YAAA;UACAN,OAAA,YAAAM,YAAA;QACA;QACA,IAAAC,SAAA;UACAP,OAAA,WAAAO,SAAA;QACA;QAEA,IAAAP,OAAA;UACA,KAAAlE,QAAA,CAAAiE,OAAA,CAAAC,OAAA;QACA;;QAEA;QACA,KAAA5C,cAAA;QACA,KAAA3C,sBAAA;MAEA,SAAAsC,KAAA;QACAf,OAAA,CAAAC,GAAA;;QAEA;QACA,KAAAxB,sBAAA,CAAAiD,OAAA,CAAAC,MAAA;UACAA,MAAA,CAAAe,aAAA;QACA;MACA;IACA;IAEA;IACA8B,oBAAAC,GAAA;MACA,KAAA7D,aAAA,CAAA6D,GAAA;IACA;IAEA;IACAC,wBAAAvE,OAAA;MACA,KAAAvB,cAAA,GAAAuB,OAAA;MACA,KAAAoB,kBAAA;IACA;IAEA;IACAoD,wBAAAvE,QAAA;MACA,KAAAvB,eAAA,GAAAuB,QAAA;MACA,KAAAxB,cAAA;MACA,KAAA2C,kBAAA;IACA;IAEA;IACAqD,WAAAC,OAAA;MACA,KAAAA,OAAA;MACA;QACA,MAAAC,IAAA,OAAAC,IAAA,CAAAF,OAAA;QACA,OAAAC,IAAA,CAAAE,kBAAA;UACAC,IAAA;UACAC,KAAA;UACAC,GAAA;QACA,GAAAC,OAAA;MACA,SAAAC,CAAA;QACA,OAAAR,OAAA;MACA;IACA;IAEA;IACA9B,UAAApB,MAAA;MACA,KAAAA,MAAA,CAAAS,OAAA,IAAAT,MAAA,CAAAO,UAAA;MAEA,MAAAoD,OAAA,OAAAP,IAAA,CAAApD,MAAA,CAAAS,OAAA;MACA,MAAAmD,GAAA,OAAAR,IAAA;MACA,OAAAQ,GAAA,GAAAD,OAAA;IACA;IAEA;IACAE,qBAAA7D,MAAA;MACA,UAAAoB,SAAA,CAAApB,MAAA;MAEA,MAAA2D,OAAA,OAAAP,IAAA,CAAApD,MAAA,CAAAS,OAAA;MACA,MAAAmD,GAAA,OAAAR,IAAA;MACA,MAAAU,QAAA,GAAAF,GAAA,GAAAD,OAAA;MACA,OAAAI,IAAA,CAAAC,IAAA,CAAAF,QAAA;IACA;IAEA;IACAG,uBAAAjE,MAAA;MACA,KAAAA,MAAA,CAAAS,OAAA,SAAAW,SAAA,CAAApB,MAAA;MAEA,MAAA2D,OAAA,OAAAP,IAAA,CAAApD,MAAA,CAAAS,OAAA;MACA,MAAAmD,GAAA,OAAAR,IAAA;MACA,MAAAU,QAAA,GAAAH,OAAA,GAAAC,GAAA;MACA,OAAAG,IAAA,CAAAC,IAAA,CAAAF,QAAA;IACA;IAEA;IACAI,wBAAAlE,MAAA;MACA,MAAAmE,IAAA,QAAAF,sBAAA,CAAAjE,MAAA;MACA,IAAAmE,IAAA;MACA,IAAAA,IAAA;MACA;IACA;IAEA;IACAC,wBAAApE,MAAA;MACA,KAAAA,MAAA,CAAAK,UAAA;MAEA,MAAAgE,UAAA,OAAAjB,IAAA,CAAApD,MAAA,CAAAK,UAAA;MACA,MAAAiE,UAAA,GAAAtE,MAAA,CAAAO,UAAA,OAAA6C,IAAA,CAAApD,MAAA,CAAAO,UAAA,QAAA6C,IAAA;MACA,MAAAU,QAAA,GAAAQ,UAAA,GAAAD,UAAA;MACA,MAAAF,IAAA,GAAAJ,IAAA,CAAAQ,KAAA,CAAAT,QAAA;MAEA,OAAAK,IAAA,UAAAA,IAAA;IACA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}